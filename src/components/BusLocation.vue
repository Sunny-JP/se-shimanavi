<script setup>
import { ref, computed, watchEffect } from "vue";

// 五十音リスト
const kanaRows = ref(["北", "あ", "か", "さ", "た", "な", "は", "ま", "や"]);

// 停留所リスト（五十音ごとに設定）
const stationGroups = ref({
  北: ["松江駅","くにびきメッセ前","北公園","学園南二丁目","母衣小学校前","附属学園入口","城東保育所入口","学園通り中央","学園通り北","川津","島根大学前","菅田庵入口","菅田町","大界入口","東奥谷町","淞北台団地入口","春日住宅前","田原谷池","春日三区","春日西","春日南","黒田町井出の内","ふなつ橋","黒田町","月照寺入口","宮ノ丁","堂形入口","交融橋","松江しんじ湖温泉駅","市役所前","県庁南入口","国宝松江城県庁前","県民会館前","須衛都久神社前","宍道湖大橋南詰","灘町","天神町中央","寺町","朝日町"],
  あ: ["相生町","相生町入口","上谷","上谷南","上乃木","朝酌公民館前","朝酌郵便局前","朝日ヶ丘北","朝日ヶ丘西","朝日ヶ丘南","朝日橋","朝日町","あじさい団地","あじさい団地入口","阿須伎神社入口","あすなろ橋","出雲郷","出雲郷橋","天路前","荒茅入口","荒木小学校前","荒島駅","有","有原入口","イオン松江店前","イオンモール出雲前","生馬が丘","生馬が丘西","生馬が丘南","いこい家小浜前","石橋三丁目","石橋町","石橋四丁目","出雲工業高校前","ＪＲ出雲市駅","出雲市役所前","出雲須佐","出雲大社バスターミナル","出雲ドーム西","出雲二見","板津上口","市成","一の原","一畑バス本社","井出平","井出分","意東","稲佐の浜","稲佐の浜入口","岩汐","イングリッシュガーデン前","忌部神社","忌部宮内","上野医院前","魚町","うぐいす台","海潮温泉","海潮温泉上","海潮交流センター前","海潮小学校前","後山","内中原小学校前","運転免許センター","宇竜","宇竜入口","宇竜分れ","宇和佐","運動公園入口","駅通り四つ角","エコステーション","江島","恵曇","恵曇郵便局前","円光寺前","王陵の丘公園入口","大井","大井神社前","大井神社前フリー大海崎","大内谷","大川端","大木","大界","大界入口","大界中央","大島","大島上","大手前堀川遊覧船乗場・歴史館前","大橋北詰","大橋南詰","大庭小学校前","大庭十字路","大庭団原","大庭橋","大海崎","大海崎橋","大海崎フリー大海崎橋","岡住宅入口","小川尻","小倉","遅江","ＪＲ小田駅","小田駅前","乙立","小山団地前","小山町","小山保育園前","卸団地","温泉上","温泉下"],
  か: ["開運稲荷前","回送","鍛冶橋","海上南","鑑町","垣の内","学園通り北","学園通り中央","学園南二丁目","鹿島中学校前","鹿島ふれあい館","鹿島ふれあい館入口","春日三区","春日住宅前","春日西","春日南","家庭学院入口","河南中学校入口","上宇部尾町","上塩冶車庫","上大川端","上口","上組","上組公民館前","上講武入口","上佐陀","亀尻","カラコロ工房前","川井入口","川津","川成橋","川原","川部入口","観音寺西","菅田庵入口","神門沖上","神戸橋西詰","神納橋","かんべの里","神前一丁目","願楽寺入口","北荒木","北垣","北公園","北講武","北消防署前","北田町","北殿町","北堀町","北山団地入口","吉兆館前","客ヶ丘入口","旧ＪＲ大社駅","教会入口","京橋","久多美","くにびき駐車場前","くにびきメッセ前","久米","熊山","久村","国屋","黒田","黒田町","黒田町安台原","黒田町井出の内","月照寺入口","月照寺前","県営住宅前","県合同庁舎前","原子力発電所入口","這田","県庁南入口","県民会館前","県立大学前","県立美術館","県立美術館前","小泉八雲記念館前","公園墓地","公園墓地入口","公園墓地管理棟前","公園墓地中央","ごうぎん大東支店","高専前","郷戸","交融橋","コーポ一畑入口","国際交流会館前","国宝松江城大手前","国宝松江城県庁前","古志橋東詰","古志原","古志原住宅前","古志原郵便局前","古曽志奥組","古曽志上組","古曽志公園入口","古代出雲歴史博物館前","湖南中学校前","小平","小丸子","こも沢","湖陵温泉入口","湖陵郵便局前"],
  さ: ["雑賀三番街","才の谷入口","才ノ谷団地入口","才の峠","裁判所前","幸町","界橋","栄橋","坂本","佐草十字路","作橋","さざなみ学園前","佐田大橋","佐陀大橋","佐田行政センター前","佐太神社前","三中前","三本松","サンライフ松江前","ＪＡしまね大庭店前","ＪＦ加賀出張所前","自衛隊前","塩見縄手","塩見縄手入口","四季ヶ丘入口","四季ヶ丘北","四季ヶ丘西","四季ヶ丘東","四季ヶ丘南","四十間堀川","知谷橋","島根大学","島根大学病院","島根大学前","島根ワイナリー","市民会館前","下朝山","下組公民館前","下佐陀","下佐陀下","蛇池","市役所前","蛇島","社日公園前","授産センター","授産センター前","ジュンテンドー出雲南店前","床几山入口","商業高校前","城西公民館前","城東保育所入口","勝負","淞北台団地","淞北台団地入口","女子高校前","ショッピングタウンエル前","市立病院","白枝","白枝北","新大橋北詰","新大橋南詰","新小浜橋","神西沖分","宍道湖大橋北詰","宍道湖大橋南詰","宍道湖遊覧船乗場","新庄","新庄入口","真浄寺前","新土手入口","新縄手橋","新縄手橋・松江記念病院入口","新町","新山入口","須衛都久神社前","水源地","須賀","須賀下口","菅田町","須谷医院前","砂子坂","砂原","すまいる苑前","生協病院入口","生協病院前","清光院下","整肢学園前","正門前","善花","千本","千本つつじが丘","総合体育館前","荘厳寺前","祖子分","袖師町","袖師町西","ソフトビジネスパーク入口"],
  た: ["胎泉寺前","大東駅前","大東税務署前","大東東町","大東郵便局前","第二県営住宅前","第二淞北台団地入口","太陽団地入口","鷹日神社入口","鷹日神社東入口","高松","宝谷団地前","嵩","武内神社前","竹崎団地入口","田島","嵩山入口","武代","嵩見団地入口","手角","立久恵峡","立久恵峡中","立花整骨院前","竪町","谷合橋","玉造温泉","玉造温泉入口","玉造温泉駅入口","玉湯学園前","田和山","田和山史跡公園","田原谷池","地域医療機構玉造病院","地域医療機構玉造病院入口","竹矢","千鳥町","千鳥南公園","茶山","中央病院","中央郵便局前","長者原","長者原団地前","築山新町","附谷入口","津田小学校入口","津田小学校前","津田明神入口","常松町","手貝","テクノアークしまね","寺田橋","寺津","寺津入口","寺町","天神団地入口","天神町","天神町中央","電鉄大社駅","手間","手間（馬潟）","天満宮前（出雲）","天満宮前","天倫寺前","堂形","堂形入口","東光台入口","堂ノ前","堂の前","東林寺前","殿川内","殿森","富原","富原三叉路","富原東"],
  な: ["内陸団地","長池","中尾","中組公民館前","長沢","中天神","中戸","中之島","長海","中屋","中山","中山支所前","中山東","仲良し橋","灘町","七日市","南原","南平台入口","西生馬","西揖屋","西尾回転場","西尾団地入口","西川津","西津田七丁目","西谷","西の谷入口","西の浜","西の原住宅前","西原","西日吉団地前","西持田","西嫁島二丁目","虹","日赤病院入口","日赤病院前","二本橋","ニュー学園台入口","入江","農林高校前","乃木駅","乃木小学校入口","乃木二子塚古墳前","乃木保育所入口","乃白","乃白北","野原"],
  は: ["橋本","橋本橋","畑尻","八幡前","八曽利","はなうみ苑","鼻曲","羽入","波入","浜佐田灘公民館前","浜根","浜乃木","浜乃木一丁目","浜乃木灘中","浜乃木七丁目","浜乃木二丁目","浜乃木六丁目","浜山公園入口","原","半瀬橋","半分","東上乃木","東朝日町","東朝日町宮の沖","東生馬","東揖屋","東奥谷町","東川津","東高校","東淞北台","東天神町","東入江","東福富","東福富フリー岩汐","比津","比津が丘入口","比津が丘三丁目","比津が丘郵便局前","桧山","日御碕神社","日御碕灯台","旭の森","姫神広場","姫原町","日吉","平賀","平口","平松","福祉センター前","福富団地入口","福富町","福富橋","福原","藤谷入口","布志名","布志名西","布志名東","附属学園入口","附属学園前","二子","二つ池","二俣","風土記の丘","風土記の丘入口","ふなつ橋","プラバホール入口","プラバホール東入口","プラバホール前","古江","古江小学校入口","ふれあい館","ふれあい館入口","文化センター入口","文化センター東入口","文化センター前","平成町車庫","平成ニュータウン北","平成ニュータウン西","平成ニュータウン東","平成ニュータウン南","奉納山入口","法吉","法吉回転場","法吉公会堂前","法吉公民館前","法吉団地","法吉団地東","法吉団地南","堀川遊覧船乗場","母衣小学校前","本郷","本庄","本庄中学校入口","本庄郵便局前"],
  ま: ["馬潟","曲松","馬木","牧野内科医院前","槙山入口","幕島","枕木山入口","松江医療センター","松江医療センター前","松江駅","松江駅南口","松江記念病院","松江警察署前","松江市交通局","松江市役所鹿島支所前","松江市役所玉湯支所入口","松江しんじ湖温泉","松江しんじ湖温泉駅","馬橋","マリンプラザ前","馬渡","満願寺前","万原","万原入口","弥久賀神社前","水上","みせん広場前","道の駅本庄","御津","美月","御津越土","御津体育館下","南高校前","みなみ小学校前","南田町","南田町東","南殿町","南村","みのりが丘","美保関ターミナル","宮ノ丁","妙見下","明谷","向名","向名上","百足橋","麦島","向市場","売豆紀丁入口","盲学校入口","持田"],
  や: ["八重垣神社","八重垣団地入口","八雲車庫","八雲台入口","やすらぎの里前","やそり橋","矢田","矢田朝酌","矢田フリー福富町","矢田渡し場","矢田渡し場フリー矢田","八束支所・中村元記念館前","八束体育館前","八束町・由志園入口","八束町由志園入口","八野神社入口","矢の原","矢の原入口","山奥公民館前","山崎入口","山路","山代住宅前","山代町","山代町入口","夕日公園前","郵便局前","由貴神社前","有楽町入口","ゆけむり大橋前","湯町東","ゆめタウン出雲前","要害橋","遥堪","養護学校乃木校舎前","養護学校前","横浜町","四絡コミュニティセンター前","四絡東","嫁ヶ島西","嫁ヶ島夕日公園","楽山入口","楽山公園入口","楽山橋","ラピタはまやま店前","わかあゆの里入口","和田","渡橋（安来）","渡橋","渡橋沖","渡橋北"]
});

// ローカルストレージから取得（初期値を設定）
const selectedFromRow = ref(localStorage.getItem("selectedFromRow") || "");
const selectedToRow = ref(localStorage.getItem("selectedToRow") || "");
const from = ref(localStorage.getItem("from") || "松江駅");
const to = ref(localStorage.getItem("to") || "松江駅");

// 停留所リストをフィルタリング
const filteredFromStations = computed(() => {
  return selectedFromRow.value ? stationGroups.value[selectedFromRow.value] || [] : Object.values(stationGroups.value).flat();
});

const filteredToStations = computed(() => {
  return selectedToRow.value ? stationGroups.value[selectedToRow.value] || [] : Object.values(stationGroups.value).flat();
});

// URL生成
const busUrl = computed(() => {
  if (from.value && to.value) {
    return `https://mi.bus-navigation.jp/wgsys/wgs/bus.htm?tabName=searchTab&selectedLandmarkCatCd=&from=${from.value}&fromType=&to=${to.value}&toType=&locale=ja&fromlat=&fromlng=&tolat=&tolng=&fromSignpoleKey=&routeLayoutCd=&bsid=1&fromBusStopCd=&toBusStopCd=&mapFlag=false&existYn=N&routeKey=&nextDiagramFlag=&diaRevisedDate=&timeTableDirevtionCd=`;
  }
  return "";
});

// 乗車・降車の入れ替え
const swapBusStations = () => {
  [from.value, to.value] = [to.value, from.value];
  [selectedFromRow.value, selectedToRow.value] = [selectedToRow.value, selectedFromRow.value];
};

// 値を `localStorage` に保存
watchEffect(() => {
  localStorage.setItem("selectedFromRow", selectedFromRow.value);
  localStorage.setItem("selectedToRow", selectedToRow.value);
  localStorage.setItem("from", from.value);
  localStorage.setItem("to", to.value);
});
</script>

<template>
  <div>
    <div v-if="busUrl">
      <iframe class="bus" :src="busUrl"></iframe>
    </div>
    <div class="bus-option">
      <div class="selector-group">
        <select class="custom-select" v-model="selectedFromRow">
          <option value="">All</option>
          <option v-for="row in kanaRows" :key="'from-' + row" :value="row">
            {{ row }}
          </option>
        </select>

        <select class="custom-select" v-model="from">
          <option v-for="station in filteredFromStations" :key="station">
            {{ station }}
          </option>
        </select>
      </div>

      <button @click="swapBusStations" class="swap-button">
        <font-awesome-icon icon="arrow-right-arrow-left" class="icon" />
      </button>

      <div class="selector-group">
        <select class="custom-select" v-model="selectedToRow">
          <option value="">All</option>
          <option v-for="row in kanaRows" :key="'to-' + row" :value="row">
            {{ row }}
          </option>
        </select>

        <select class="custom-select" v-model="to">
          <option v-for="station in filteredToStations" :key="station">
            {{ station }}
          </option>
        </select>
      </div>

    </div>
  </div>
</template>
